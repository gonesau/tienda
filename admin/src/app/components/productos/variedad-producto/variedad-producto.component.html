<app-sidebar></app-sidebar>

<main class="admin-content">
  <div class="admin-main">
    
    <!-- Page Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 pb-3 border-bottom">
      <div class="mb-3 mb-md-0">
        <h1 class="h2 mb-2">Variedades del Producto</h1>
        <p class="text-muted mb-0">Configura las opciones o versiones disponibles</p>
      </div>
      <a class="btn btn-outline-secondary" [routerLink]="['/panel/productos']">
        <i class="fas fa-arrow-left me-2"></i>Volver
      </a>
    </div>

    <!-- Loading State -->
    <div class="card" *ngIf="load_data">
      <div class="card-body text-center py-5">
        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="text-muted mb-0">Cargando producto...</p>
      </div>
    </div>

    <!-- Producto no encontrado -->
    <div class="card" *ngIf="!producto && !load_data">
      <div class="card-body text-center py-5">
        <i class="fas fa-box-open text-muted mb-3" style="font-size: 4rem; display: block;"></i>
        <h4 class="mb-3">Producto no encontrado</h4>
        <p class="text-muted mb-4">El producto que buscas no existe o fue eliminado</p>
        <a class="btn btn-primary" [routerLink]="['/panel/productos']">
          <i class="fas fa-arrow-left me-2"></i>Volver a Productos
        </a>
      </div>
    </div>

    <!-- Contenido Principal -->
    <div *ngIf="producto && !load_data">

      <!-- Card del Producto -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-auto">
              <img
                [src]="url + 'obtener_portada/' + producto.portada"
                [alt]="producto.titulo"
                class="rounded"
                style="width: 100px; height: 100px; object-fit: cover;"
                onerror="this.src='assets/img/no-image.png'"
              />
            </div>
            <div class="col">
              <h3 class="mb-2">{{ producto.titulo }}</h3>
              <p class="text-muted mb-2">{{ producto.descripcion }}</p>
              <span class="badge bg-primary">
                {{ producto.precio | currency:'USD' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-4">

        <!-- Columna Principal -->
        <div class="col-lg-8">

          <!-- Configuración de Variedades -->
          <div class="card">
            <div class="card-header bg-light">
              <h5 class="mb-0">
                <i class="fas fa-sliders-h me-2 text-primary"></i>Configuración de Variedades
              </h5>
            </div>
            <div class="card-body">
              
              <!-- Nombre del Grupo de Variedades -->
              <div class="mb-4">
                <label for="titulo_variedad" class="form-label">
                  Nombre del Grupo de Variedades <span class="text-danger">*</span>
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="titulo_variedad"
                  name="titulo_variedad"
                  placeholder="Ej: Talla, Color, Sabor, Capacidad..."
                  [(ngModel)]="producto.titulo_variedad"
                />
                <small class="form-text text-muted">
                  Define el nombre general de la variedad. Ejemplo: "Tallas" si vas a agregar S, M, L, XL
                </small>
              </div>

              <!-- Agregar Nueva Variedad -->
              <div class="mb-4">
                <label for="nueva_variedad" class="form-label">
                  Agregar Valor de Variedad
                </label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    id="nueva_variedad"
                    name="nueva_variedad"
                    placeholder="Ej: S, M, L, XL o Rojo, Azul, Verde..."
                    [(ngModel)]="nueva_variedad"
                    (keyup.enter)="agregar_variedad()"
                  />
                  <button
                    class="btn btn-primary"
                    type="button"
                    (click)="agregar_variedad()">
                    <i class="fas fa-plus me-1"></i>Agregar
                  </button>
                </div>
                <small class="form-text text-muted">
                  Agrega los valores individuales (uno por uno)
                </small>
              </div>

              <!-- Lista de Variedades -->
              <div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6 class="mb-0">Variedades Registradas ({{ producto.variedades?.length || 0 }})</h6>
                </div>

                <!-- Empty State -->
                <div class="alert alert-info" *ngIf="!producto.variedades || producto.variedades.length === 0">
                  <i class="fas fa-info-circle me-2"></i>
                  No hay variedades registradas. Agrega la primera usando el campo superior.
                </div>

                <!-- Lista con Badges -->
                <div class="variedades-list" *ngIf="producto.variedades && producto.variedades.length > 0">
                  <div 
                    class="variedad-item"
                    *ngFor="let item of producto.variedades; let i = index">
                    <span class="variedad-nombre">{{ item.titulo }}</span>
                    <button
                      class="btn-eliminar"
                      type="button"
                      (click)="eliminar_variedad(i)"
                      title="Eliminar">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
              </div>

            </div>
            <div class="card-footer d-flex justify-content-end">
              <button
                type="button"
                class="btn btn-success"
                (click)="actualizar()"
                [disabled]="load_btn">
                <span *ngIf="!load_btn">
                  <i class="fas fa-save me-2"></i>Guardar Variedades
                </span>
                <span *ngIf="load_btn">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Guardando...
                </span>
              </button>
            </div>
          </div>

        </div>

        <!-- Columna Lateral -->
        <div class="col-lg-4">

          <!-- Ayuda -->
          <div class="card mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">
                <i class="fas fa-question-circle me-2 text-primary"></i>¿Cómo funciona?
              </h5>
            </div>
            <div class="card-body">
              <div class="small">
                <p><strong>1. Nombre del Grupo:</strong></p>
                <p class="text-muted mb-3">
                  Define qué tipo de variedad tiene tu producto (Ej: "Talla", "Color", "Sabor")
                </p>

                <p><strong>2. Valores:</strong></p>
                <p class="text-muted mb-3">
                  Agrega cada opción disponible (Ej: "S", "M", "L", "XL")
                </p>

                <p><strong>3. Guardar:</strong></p>
                <p class="text-muted mb-0">
                  Haz clic en "Guardar Variedades" para aplicar los cambios
                </p>
              </div>
            </div>
          </div>

          <!-- Ejemplos -->
          <div class="card">
            <div class="card-header bg-light">
              <h5 class="mb-0">
                <i class="fas fa-lightbulb me-2 text-warning"></i>Ejemplos
              </h5>
            </div>
            <div class="card-body">
              <div class="small">
                <div class="mb-3">
                  <strong class="text-primary">Ropa:</strong>
                  <div class="mt-1">
                    <span class="badge bg-light text-dark me-1">Grupo: Talla</span><br>
                    <span class="badge bg-secondary me-1 mt-2">S</span>
                    <span class="badge bg-secondary me-1 mt-2">M</span>
                    <span class="badge bg-secondary me-1 mt-2">L</span>
                    <span class="badge bg-secondary mt-2">XL</span>
                  </div>
                </div>

                <div class="mb-3">
                  <strong class="text-primary">Electrónica:</strong>
                  <div class="mt-1">
                    <span class="badge bg-light text-dark me-1">Grupo: Capacidad</span><br>
                    <span class="badge bg-secondary me-1 mt-2">64GB</span>
                    <span class="badge bg-secondary me-1 mt-2">128GB</span>
                    <span class="badge bg-secondary mt-2">256GB</span>
                  </div>
                </div>

                <div>
                  <strong class="text-primary">Bebidas:</strong>
                  <div class="mt-1">
                    <span class="badge bg-light text-dark me-1">Grupo: Sabor</span><br>
                    <span class="badge bg-secondary me-1 mt-2">Fresa</span>
                    <span class="badge bg-secondary me-1 mt-2">Vainilla</span>
                    <span class="badge bg-secondary mt-2">Chocolate</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>

  </div>
</main>