<app-sidebar> </app-sidebar>

<!-- Page title-->
<div class="border-bottom pt-5 mt-2 mb-5">
  <h1 class="mt-2 mt-md-4 mb-3 pt-5">Editar Cupón</h1>
  <div class="d-flex flex-wrap flex-md-nowrap justify-content-between">
    <p class="text-muted">Modifica los detalles del cupón de descuento.</p>
     <p class="font-size-sm font-weight-medium pl-md-4">
        <a class="text-nowrap" [routerLink]="['/panel/cupones']"
          >Regresar<i
            class="cxi-angle-right font-size-base align-middle ml-1"
          ></i
        ></a>
      </p>
  </div>
</div>

<!-- Precargador inicial -->
<div *ngIf="load_data" class="text-center py-5">
    <div
      class="spinner-border text-primary"
      style="width: 3rem; height: 3rem"
      role="status"
    >
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 text-muted">Cargando datos del cupón...</p>
</div>

<!-- Contenido del formulario o mensaje de error -->
<div *ngIf="!load_data">
    <!-- Cupón no encontrado -->
    <div *ngIf="!cupon" class="card box-shadow-sm">
         <div class="card-body text-center py-5">
            <h3 class="mb-3">Cupón no encontrado</h3>
            <img
                src="assets/img/error.png"
                alt="Error"
                class="mb-3"
                style="width: 150px; height: auto"
            />
            <p class="text-muted">El cupón que buscas no existe o fue eliminado.</p>
            <a [routerLink]="['/panel/cupones']" class="btn btn-primary">
                Volver a Cupones
            </a>
        </div>
    </div>
    
    <!-- Formulario de actualización -->
    <form #actualizarForm="ngForm" (ngSubmit)="actualizar(actualizarForm)" *ngIf="cupon">
        <div class="card box-shadow-sm">
            <div class="card-header">
            <h5 class="mb-0">Detalles del Cupón</h5>
            </div>

            <div class="card-body">
            <div class="row">

                <!-- Tipo de Cupón -->
                <div class="col-md-6 form-group mb-4">
                    <label for="tipo" class="form-label">Tipo de Cupón <span class="text-danger">*</span></label>
                    <select
                    id="tipo"
                    class="form-control custom-select"
                    required
                    name="tipo"
                    [(ngModel)]="cupon.tipo"
                    #tipo="ngModel"
                    [ngClass]="{'is-invalid': tipo.invalid && tipo.touched}"
                    >
                    <option value="" disabled selected>Seleccione una opción</option>
                    <option value="Porcentaje">Porcentaje</option>
                    <option value="Valor fijo">Valor fijo</option>
                    </select>
                    <div *ngIf="tipo.invalid && tipo.touched" class="invalid-feedback">
                        El tipo de cupón es requerido.
                    </div>
                </div>

                <!-- Código -->
                <div class="col-md-6 form-group mb-4">
                <label for="codigo" class="form-label">Código del Cupón</label>
                <input
                    id="codigo"
                    class="form-control"
                    type="text"
                    placeholder="Ej: DIA-DEL-PADRE"
                    required
                    name="codigo"
                    [(ngModel)]="cupon.codigo"
                    #codigo="ngModel"
                    [disabled]="true"
                />
                <small class="form-text text-muted">El código no se puede modificar.</small>
                </div>

                <!-- Valor -->
                <div class="col-md-6 form-group mb-4">
                <label for="valor" class="form-label">Valor del Descuento <span class="text-danger">*</span></label>
                <div class="input-group">
                    <span class="input-group-text" *ngIf="cupon.tipo === 'Valor fijo'">$</span>
                    <input
                        id="valor"
                        class="form-control"
                        type="number"
                        placeholder="Ej: 25"
                        required
                        min="1"
                        name="valor"
                        [(ngModel)]="cupon.valor"
                        #valor="ngModel"
                        [ngClass]="{'is-invalid': valor.invalid && valor.touched}"
                    />
                    <span class="input-group-text" *ngIf="cupon.tipo === 'Porcentaje'">%</span>
                    <div *ngIf="valor.invalid && valor.touched" class="invalid-feedback">
                        <span *ngIf="valor.errors?.['required']">El valor es requerido.</span>
                        <span *ngIf="valor.errors?.['min']">El valor debe ser mayor a 0.</span>
                    </div>
                </div>
                </div>

                <!-- Límite de Usos -->
                <div class="col-md-6 form-group mb-4">
                <label for="limite" class="form-label">Límite de Usos <span class="text-danger">*</span></label>
                <input
                    id="limite"
                    class="form-control"
                    type="number"
                    placeholder="Ej: 100"
                    required
                    min="0"
                    name="limite"
                    [(ngModel)]="cupon.limite"
                    #limite="ngModel"
                    [ngClass]="{'is-invalid': limite.invalid && limite.touched}"
                />
                <div *ngIf="limite.invalid && limite.touched" class="invalid-feedback">
                    <span *ngIf="limite.errors?.['required']">El límite es requerido.</span>
                    <span *ngIf="limite.errors?.['min']">El límite debe ser 0 o mayor.</span>
                </div>
                </div>

            </div>
            </div>

            <div class="card-footer d-flex justify-content-end">
                <a routerLink="/panel/cupones" class="btn btn-outline-secondary me-3">Cancelar</a>
            <button 
                class="btn btn-primary" 
                type="submit"
                [disabled]="actualizarForm.invalid || load_btn">
                <span *ngIf="!load_btn">
                    <i class="cxi-save me-2"></i>Actualizar Cupón
                </span>
                <span *ngIf="load_btn">
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Actualizando...
                </span>
            </button>
            </div>
        </div>
    </form>
</div>
